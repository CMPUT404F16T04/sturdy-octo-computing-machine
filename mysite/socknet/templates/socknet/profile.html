{% extends "base.html" %}
{% block content %}

<h1>{{ profile_author.user.username }}'s Profile!</h1>
<div class = "profileInfo">
    {% if profile_author.uuid == user.author.uuid %}
        <!-- Author is viewing their own profile, display edit button -->
        <p>This button doesn't go anywhere right now.</p>
        <input type="submit" name="editProfile" value="Edit Profile"/>
    {% else %}
        <!-- Author is viewing someone else's profile, display button that allows
             them to follow, unfollow, unfriend, etc. -->
        <a id="friend_anchor" href="#" class="friend-anchor"
        data-uuid="{{ profile_author.uuid }}" data-username="{{ profile_author.user.username }}" data-status="{{ button_action }}"></a>
    {% endif %}

</div>
<div class="postList">
    <h2>My Post List</h2>
    <ol class="feed">
        {% for post in context_list %}
        {% if post.author.uuid == profile_author.uuid %}
            <li class="post">
            {% if profile_author.uuid == user.author.uuid %}
            <a class = "delete" href="{% url 'author_check_delete' pk=post.pk %}">x</a>
            {% endif %}
              <p class="authordate">
                Author: {{ post.author.user.username }}<br/>
                Created On (UTC): {{ post.created_on }}
              </p>
              <article class="content">
                {{post.view_content|safe}}
              </article>
            </li>
        {% endif %}
        {% endfor %}
    </ol>
  </div>
{% endblock %}

{% block scripts %}
{% load static from staticfiles %}
<script src="{% static 'js/friend_request_handler.js' %}"></script>
<script type="text/javascript">
    // authorUUID and url are needed in friend_request_handler (above)
    var authorUUID = "{{ user.author.uuid }}";
    var url = "{% url 'manage_friends' authorUUID=user.author.uuid %}";

    $(document).ready(function() {
        console.log("Profile is loaded");
        console.log("Action button: "+"{{ button_action }}")
        if ("{{ user.author.uuid }}" !== "{{ profile_author.uuid }}") {
            // Set text of friend button based on current relationship
            if("{{ button_action }}" === "unfriend") {
                $('#friend_anchor').text("Unfriend");
            } else if ("{{ button_action }}" === "follow") {
                $('#friend_anchor').text("Follow");
            } else if ("{{ button_action }}" === "accept_friend_request") {
                $('#friend_anchor').text("Accept Friend Request");
            } else if ("{{ button_action }}" === "unfollow") {
                $('#friend_anchor').text("Unfollow");
            }
        }
    });
</script>

{% endblock scripts %}
